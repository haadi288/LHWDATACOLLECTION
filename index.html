<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <link crossorigin="" href="https://fonts.gstatic.com/" rel="preconnect"/>
    <link as="style" href="https://fonts.googleapis.com/css2?display=swap&amp;family=Noto+Sans%3Awght%40400%3B500%3B700%3B900&amp;family=Work+Sans%3Awght%40400%3B500%3B700%3B900" onload="this.rel='stylesheet'" rel="stylesheet"/>
    <title>LHW Data Collection App</title>
    <link href="data:image/x-icon;base64," rel="icon" type="image/x-icon"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <style type="text/tailwindcss">
        :root {
            --primary-color: #137fec;
            --primary-color-focus: #137fec33;
        }
        .form-input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px var(--primary-color-focus);
        }
        .modal-backdrop {
            backdrop-filter: blur(8px);
            background: rgba(0, 0, 0, 0.4);
        }
        .notification {
            transform: translateX(100%);
            transition: transform 0.3s ease-in-out;
        }
        .notification.show {
            transform: translateX(0);
        }
        .loading-dots {
            animation: loadingDots 1.5s infinite;
        }
        @keyframes loadingDots {
            0%, 20% { opacity: 0; }
            50% { opacity: 1; }
            100% { opacity: 0; }
        }
        .loading-dots:nth-child(2) { animation-delay: 0.3s; }
        .loading-dots:nth-child(3) { animation-delay: 0.6s; }
        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .pulse-border {
            animation: pulseBorder 2s infinite;
        }
        @keyframes pulseBorder {
            0%, 100% { border-color: #137fec; }
            50% { border-color: #60a5fa; }
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800" style='font-family: "Work Sans", "Noto Sans", sans-serif;'>
    <div class="relative flex size-full min-h-screen flex-col group/design-root overflow-x-hidden">
        <div class="layout-container flex h-full grow flex-col">


            <!-- Main Content -->
            <main class="flex flex-1 justify-center py-10 px-4 sm:px-6 lg:px-8">
                <div class="w-full max-w-2xl">
                    <div class="bg-white rounded-xl shadow-lg p-8 fade-in">
                        <div class="mb-8 text-center">
                            <h1 class="text-3xl font-bold text-gray-900 tracking-tight">Data Entry Form</h1>
                            <p class="text-gray-500 mt-2">Fill in the details below to submit a new record.</p>
                            <div id="progress-indicator" class="mt-4 w-full bg-gray-200 rounded-full h-2 hidden">
                                <div id="progress-bar" class="bg-[var(--primary-color)] h-2 rounded-full transition-all duration-500" style="width: 20%"></div>
                            </div>
                        </div>

                        <!-- Form -->
                        <form id="lhw-form" class="space-y-6">
                            <!-- UC Name and Number Row -->
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                                <div>
                                    <label class="flex flex-col">
                                        <p class="text-sm font-medium text-gray-700 pb-2">UC Name <span class="text-red-500">*</span></p>
                                        <input 
                                            id="ucName" 
                                            name="ucName"
                                            class="form-input flex w-full rounded-md border-gray-300 bg-gray-50 shadow-sm transition-all duration-200 h-11 px-4 placeholder:text-gray-400" 
                                            placeholder="Enter UC Name" 
                                            required
                                            autocomplete="off"
                                        />
                                    </label>
                                    <div id="ucName-error" class="text-sm text-red-600 mt-1 hidden"></div>
                                </div>
                                <div>
                                    <label class="flex flex-col">
                                        <p class="text-sm font-medium text-gray-700 pb-2">UC Number <span class="text-red-500">*</span></p>
                                        <input 
                                            id="ucNumber" 
                                            name="ucNumber"
                                            class="form-input flex w-full rounded-md border-gray-300 bg-gray-50 shadow-sm transition-all duration-200 h-11 px-4 placeholder:text-gray-400" 
                                            placeholder="Enter UC Number" 
                                            type="number" 
                                            required
                                            autocomplete="off"
                                        />
                                    </label>
                                    <div id="ucNumber-error" class="text-sm text-red-600 mt-1 hidden"></div>
                                </div>
                            </div>

                            <!-- LHW Name -->
                            <div>
                                <label class="flex flex-col">
                                    <p class="text-sm font-medium text-gray-700 pb-2">Name of LHW <span class="text-red-500">*</span></p>
                                    <input 
                                        id="lhwName" 
                                        name="lhwName"
                                        class="form-input flex w-full rounded-md border-gray-300 bg-gray-50 shadow-sm transition-all duration-200 h-11 px-4 placeholder:text-gray-400" 
                                        placeholder="Enter Name of Lady Health Worker" 
                                        required
                                        autocomplete="off"
                                    />
                                </label>
                                <div id="lhwName-error" class="text-sm text-red-600 mt-1 hidden"></div>
                            </div>

                            <!-- Household Name -->
                            <div>
                                <label class="flex flex-col">
                                    <p class="text-sm font-medium text-gray-700 pb-2">Name of Household <span class="text-red-500">*</span></p>
                                    <input 
                                        id="householdName" 
                                        name="householdName"
                                        class="form-input flex w-full rounded-md border-gray-300 bg-gray-50 shadow-sm transition-all duration-200 h-11 px-4 placeholder:text-gray-400" 
                                        placeholder="Enter Name of Head of Household" 
                                        required
                                        autocomplete="off"
                                    />
                                </label>
                                <div id="householdName-error" class="text-sm text-red-600 mt-1 hidden"></div>
                            </div>

                            <!-- Location Field -->
                            <div id="location-container">
                                <p class="text-sm font-medium text-gray-700 pb-2">Location <span class="text-red-500">*</span></p>
                                <div class="relative">
                                    <input 
                                        id="location" 
                                        name="location"
                                        class="form-input flex w-full rounded-md border-gray-300 bg-gray-100 shadow-sm transition-all duration-200 h-11 px-4 placeholder:text-gray-500 text-gray-600" 
                                        placeholder="Waiting for location detection..." 
                                        readonly
                                    />
                                    <!-- Default location icon -->
                                    <div id="location-icon" class="absolute right-3 top-1/2 -translate-y-1/2">
                                        <span class="material-symbols-outlined text-gray-400">location_on</span>
                                    </div>
                                    <!-- Loading animation -->
                                    <div id="location-loading" class="absolute right-3 top-1/2 -translate-y-1/2 flex items-center gap-1 hidden">
                                        <div class="h-2 w-2 rounded-full bg-[var(--primary-color)] loading-dots"></div>
                                        <div class="h-2 w-2 rounded-full bg-[var(--primary-color)] loading-dots"></div>
                                        <div class="h-2 w-2 rounded-full bg-[var(--primary-color)] loading-dots"></div>
                                    </div>
                                    <!-- Success icon -->
                                    <div id="location-success" class="absolute right-3 top-1/2 -translate-y-1/2 hidden">
                                        <span class="material-symbols-outlined text-green-500">check_circle_outline</span>
                                    </div>
                                    <!-- Error icon -->
                                    <div id="location-error" class="absolute right-3 top-1/2 -translate-y-1/2 hidden">
                                        <span class="material-symbols-outlined text-red-500">error_outline</span>
                                    </div>
                                    <!-- Refresh button -->
                                    <button 
                                        type="button" 
                                        id="location-refresh" 
                                        class="absolute right-10 top-1/2 -translate-y-1/2 text-blue-600 hover:text-blue-800 transition-colors hidden"
                                        title="Refresh location"
                                    >
                                        <span class="material-symbols-outlined text-sm">refresh</span>
                                    </button>
                                </div>
                                <div id="location-message" class="text-sm mt-2 hidden"></div>
                                <div id="location-actions" class="flex items-center justify-between mt-2 hidden">
                                    <p class="text-sm text-red-600">Could not detect your location. Please try again or enter it manually.</p>
                                    <div class="flex items-center gap-2">
                                        <button 
                                            type="button" 
                                            id="manual-location-btn" 
                                            class="text-sm font-medium text-gray-600 hover:text-[var(--primary-color)] transition-colors"
                                        >
                                            Manual Entry
                                        </button>
                                        <button 
                                            type="button" 
                                            id="retry-location-btn" 
                                            class="flex items-center gap-1.5 rounded-md bg-gray-100 px-3 py-1.5 text-sm font-medium text-gray-700 hover:bg-gray-200 transition-colors"
                                        >
                                            <span class="material-symbols-outlined text-base">refresh</span>
                                            <span>Retry</span>
                                        </button>
                                    </div>
                                </div>
                                <div id="location-error-msg" class="text-sm text-red-600 mt-1 hidden"></div>
                            </div>

                            <!-- Submit Button -->
                            <div class="border-t border-gray-200 pt-6 mt-8">
                                <button 
                                    type="submit" 
                                    id="submit-btn"
                                    class="w-full flex items-center justify-center gap-2 rounded-md h-12 px-6 bg-[var(--primary-color)] text-white text-lg font-bold shadow-lg hover:bg-[#106ac4] transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[var(--primary-color)] disabled:opacity-50 disabled:cursor-not-allowed"
                                >
                                    <span id="submit-icon" class="material-symbols-outlined">send</span>
                                    <span id="submit-text" class="truncate">Submit Data</span>
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </main>
        </div>

        <!-- Location Permission Modal -->
        <div 
            id="location-modal" 
            class="fixed inset-0 z-50 hidden items-center justify-center modal-backdrop"
            role="dialog" 
            aria-labelledby="modal-title" 
            aria-modal="true"
        >
            <div class="w-full max-w-sm rounded-2xl bg-white p-6 shadow-2xl text-center sm:p-8 fade-in">
                <div class="mx-auto flex h-14 w-14 items-center justify-center rounded-full bg-blue-100">
                    <span class="material-symbols-outlined text-3xl text-[var(--primary-color)]">location_on</span>
                </div>
                <div class="mt-5">
                    <h3 class="text-xl font-bold text-gray-900" id="modal-title">Enable Location Services</h3>
                    <p class="mt-2 text-sm text-gray-600">
                        This app requires access to your location to automatically tag data submissions with precise geographic coordinates.
                    </p>
                </div>
                <div class="mt-6 flex flex-col-reverse sm:flex-row sm:gap-3">
                    <button 
                        type="button" 
                        id="location-deny-btn"
                        class="mt-3 w-full rounded-md bg-gray-100 px-4 py-2.5 text-sm font-semibold text-gray-700 shadow-sm hover:bg-gray-200 transition-colors sm:mt-0"
                    >
                        Deny
                    </button>
                    <button 
                        type="button" 
                        id="location-allow-btn"
                        class="w-full rounded-md bg-[var(--primary-color)] px-4 py-2.5 text-sm font-semibold text-white shadow-sm hover:bg-[#106ac4] transition-colors"
                    >
                        Allow
                    </button>
                </div>
            </div>
        </div>

        <!-- Manual Location Modal -->
        <div 
            id="manual-location-modal" 
            class="fixed inset-0 z-50 hidden items-center justify-center modal-backdrop"
            role="dialog" 
            aria-labelledby="manual-modal-title" 
            aria-modal="true"
        >
            <div class="w-full max-w-md rounded-2xl bg-white p-6 shadow-2xl sm:p-8 fade-in">
                <div class="mx-auto flex h-14 w-14 items-center justify-center rounded-full bg-orange-100">
                    <span class="material-symbols-outlined text-3xl text-orange-600">edit_location</span>
                </div>
                <div class="mt-5">
                    <h3 class="text-xl font-bold text-gray-900" id="manual-modal-title">Enter Location Manually</h3>
                    <p class="mt-2 text-sm text-gray-600">
                        Please enter your current location details below.
                    </p>
                </div>
                <div class="mt-6 space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Address or Area</label>
                        <input 
                            type="text" 
                            id="manual-address"
                            class="w-full rounded-md border-gray-300 shadow-sm focus:border-[var(--primary-color)] focus:ring-[var(--primary-color)] px-3 py-2"
                            placeholder="Enter your address or area name"
                        />
                    </div>
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Latitude</label>
                            <input 
                                type="number" 
                                id="manual-lat"
                                step="any"
                                class="w-full rounded-md border-gray-300 shadow-sm focus:border-[var(--primary-color)] focus:ring-[var(--primary-color)] px-3 py-2"
                                placeholder="34.0151"
                            />
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Longitude</label>
                            <input 
                                type="number" 
                                id="manual-lon"
                                step="any"
                                class="w-full rounded-md border-gray-300 shadow-sm focus:border-[var(--primary-color)] focus:ring-[var(--primary-color)] px-3 py-2"
                                placeholder="71.5249"
                            />
                        </div>
                    </div>
                </div>
                <div class="mt-6 flex flex-col-reverse sm:flex-row sm:gap-3">
                    <button 
                        type="button" 
                        id="manual-cancel-btn"
                        class="mt-3 w-full rounded-md bg-gray-100 px-4 py-2.5 text-sm font-semibold text-gray-700 shadow-sm hover:bg-gray-200 transition-colors sm:mt-0"
                    >
                        Cancel
                    </button>
                    <button 
                        type="button" 
                        id="manual-save-btn"
                        class="w-full rounded-md bg-[var(--primary-color)] px-4 py-2.5 text-sm font-semibold text-white shadow-sm hover:bg-[#106ac4] transition-colors"
                    >
                        Save Location
                    </button>
                </div>
            </div>
        </div>

        <!-- Notification Container -->
        <div id="notification-container" class="fixed top-4 right-4 z-40 space-y-2"></div>

        <!-- Draft Saved Indicator -->
        <div id="draft-indicator" class="fixed bottom-4 right-4 bg-gray-700 text-white text-sm px-3 py-2 rounded shadow-lg z-40 opacity-0 transition-opacity duration-300">
            Draft saved
        </div>
    </div>

    <!-- Firebase SDK (Optional - uncomment for Firebase integration) -->
    <!-- <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script> -->
    <!-- <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script> -->

    <script type="module">
        // LHW Application Core System
        class LHWApp {
            constructor() {
                this.locationData = null;
                this.draftTimer = null;
                this.validationErrors = {};
                this.init();
            }

            init() {
                this.setupEvents();
                this.loadDraft();
                this.startLocationDetection();
                this.showWelcome();
            }

            setupEvents() {
                // Form submission
                document.getElementById('lhw-form').addEventListener('submit', (e) => this.handleSubmit(e));
                
                // Input validation and auto-save
                ['ucName', 'ucNumber', 'lhwName', 'householdName'].forEach(id => {
                    const input = document.getElementById(id);
                    input.addEventListener('input', () => {
                        this.validateField(input);
                        this.scheduleDraftSave();
                        this.updateProgress();
                    });
                });

                // Location buttons
                document.getElementById('location-allow-btn').addEventListener('click', () => this.handleGPS());
                document.getElementById('location-deny-btn').addEventListener('click', () => this.handleLocationDeny());
                document.getElementById('manual-location-btn').addEventListener('click', () => this.showManualModal());
                document.getElementById('retry-location-btn').addEventListener('click', () => this.retryLocation());
                document.getElementById('manual-save-btn').addEventListener('click', () => this.saveManualLocation());
                document.getElementById('manual-cancel-btn').addEventListener('click', () => this.hideManualModal());
            }

            // Location Detection System
            async startLocationDetection() {
                this.setLocationState('detecting');
                
                try {
                    const ipLocation = await this.getIPLocation();
                    if (ipLocation) {
                        this.locationData = ipLocation;
                        this.setLocationState('success');
                        this.showNotification('Location detected via IP', 'success');
                        return;
                    }
                } catch (error) {
                    console.log('IP failed, trying GPS...');
                }

                if (navigator.geolocation) {
                    this.showLocationModal();
                } else {
                    this.setLocationState('error');
                }
            }

            async getIPLocation() {
                const response = await fetch('https://ipapi.co/json/');
                const data = await response.json();
                
                if (data.error) throw new Error(data.reason);
                
                return {
                    lat: parseFloat(data.latitude),
                    lon: parseFloat(data.longitude),
                    address: `${data.city}, ${data.region}, ${data.country}`,
                    method: 'IP'
                };
            }

            async handleGPS() {
                this.hideLocationModal();
                this.setLocationState('detecting');
                
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        this.locationData = {
                            lat: position.coords.latitude,
                            lon: position.coords.longitude,
                            address: `${position.coords.latitude.toFixed(6)}°, ${position.coords.longitude.toFixed(6)}°`,
                            method: 'GPS'
                        };
                        this.setLocationState('success');
                        this.showNotification('GPS location detected', 'success');
                    },
                    (error) => {
                        this.setLocationState('error');
                        this.showNotification('GPS failed. Use manual entry.', 'error');
                    },
                    { enableHighAccuracy: true, timeout: 15000 }
                );
            }

            handleLocationDeny() {
                this.hideLocationModal();
                this.setLocationState('error');
                this.showNotification('Location denied. Use manual entry.', 'warning');
            }

            retryLocation() {
                this.locationData = null;
                this.startLocationDetection();
            }

            // Validation System
            validateField(input) {
                const value = input.value.trim();
                const id = input.id;
                let isValid = true;
                let message = '';
                
                input.classList.remove('border-red-500', 'border-green-500', 'bg-red-50', 'bg-green-50');
                document.getElementById(`${id}-error`).classList.add('hidden');
                
                switch (id) {
                    case 'ucName':
                        if (!value) { isValid = false; message = 'UC Name is required'; }
                        else if (value.length < 2) { isValid = false; message = 'At least 2 characters'; }
                        break;
                    case 'ucNumber':
                        if (!value) { isValid = false; message = 'UC Number is required'; }
                        else if (!/^\d+$/.test(value)) { isValid = false; message = 'Must be a number'; }
                        break;
                    case 'lhwName':
                        if (!value) { isValid = false; message = 'LHW Name is required'; }
                        else if (value.length < 2) { isValid = false; message = 'At least 2 characters'; }
                        break;
                    case 'householdName':
                        if (!value) { isValid = false; message = 'Household Name is required'; }
                        break;
                }
                
                if (value) {
                    if (isValid) {
                        input.classList.add('border-green-500', 'bg-green-50');
                        delete this.validationErrors[id];
                    } else {
                        input.classList.add('border-red-500', 'bg-red-50');
                        const errorDiv = document.getElementById(`${id}-error`);
                        errorDiv.textContent = message;
                        errorDiv.classList.remove('hidden');
                        this.validationErrors[id] = message;
                    }
                }
                
                return isValid;
            }

            // UI State Management
            setLocationState(state) {
                const input = document.getElementById('location');
                const icons = {
                    default: document.getElementById('location-icon'),
                    loading: document.getElementById('location-loading'),
                    success: document.getElementById('location-success'),
                    error: document.getElementById('location-error')
                };
                
                Object.values(icons).forEach(icon => icon.classList.add('hidden'));
                document.getElementById('location-actions').classList.add('hidden');
                document.getElementById('location-refresh').classList.add('hidden');
                
                input.className = 'form-input flex w-full rounded-md shadow-sm transition-all duration-200 h-11 px-4 placeholder:text-gray-500 text-gray-600';
                
                switch (state) {
                    case 'detecting':
                        input.className += ' border-blue-300 bg-blue-50 pulse-border';
                        input.placeholder = 'Detecting location...';
                        icons.loading.classList.remove('hidden');
                        break;
                    case 'success':
                        input.className += ' border-green-500 bg-green-50';
                        input.value = this.locationData?.address || '';
                        icons.success.classList.remove('hidden');
                        document.getElementById('location-refresh').classList.remove('hidden');
                        break;
                    case 'error':
                        input.className += ' border-red-500 bg-red-50';
                        input.placeholder = 'Location detection failed';
                        icons.error.classList.remove('hidden');
                        document.getElementById('location-actions').classList.remove('hidden');
                        break;
                    default:
                        input.className += ' border-gray-300 bg-gray-100';
                        input.placeholder = 'Waiting for location...';
                        icons.default.classList.remove('hidden');
                }
            }

            updateProgress() {
                const fields = ['ucName', 'ucNumber', 'lhwName', 'householdName'];
                let completed = fields.filter(id => {
                    const value = document.getElementById(id).value.trim();
                    return value && !this.validationErrors[id];
                }).length;
                
                if (this.locationData) completed++;
                
                const progress = (completed / 5) * 100;
                const progressBar = document.getElementById('progress-bar');
                const progressIndicator = document.getElementById('progress-indicator');
                
                if (progress > 0) {
                    progressIndicator.classList.remove('hidden');
                    progressBar.style.width = `${progress}%`;
                } else {
                    progressIndicator.classList.add('hidden');
                }
            }

            // Form Submission
            async handleSubmit(e) {
                e.preventDefault();
                
                if (!this.validateForm()) {
                    this.showNotification('Please fix all errors', 'error');
                    return;
                }
                
                const btn = document.getElementById('submit-btn');
                btn.disabled = true;
                document.getElementById('submit-text').textContent = 'Submitting...';
                
                try {
                    const data = this.getFormData();
                    await new Promise(resolve => setTimeout(resolve, 2000)); // Simulate
                    
                    const submissions = JSON.parse(localStorage.getItem('lhw_submissions') || '[]');
                    submissions.push({ ...data, id: Date.now(), submittedAt: new Date().toISOString() });
                    localStorage.setItem('lhw_submissions', JSON.stringify(submissions));
                    
                    this.showNotification('Data submitted successfully!', 'success');
                    this.clearForm();
                    
                } catch (error) {
                    this.showNotification('Submission failed', 'error');
                } finally {
                    btn.disabled = false;
                    document.getElementById('submit-text').textContent = 'Submit Data';
                }
            }

            validateForm() {
                let valid = true;
                ['ucName', 'ucNumber', 'lhwName', 'householdName'].forEach(id => {
                    if (!this.validateField(document.getElementById(id))) valid = false;
                });
                
                if (!this.locationData) {
                    valid = false;
                    document.getElementById('location-error-msg').textContent = 'Location required';
                    document.getElementById('location-error-msg').classList.remove('hidden');
                }
                
                return valid;
            }

            getFormData() {
                return {
                    ucName: document.getElementById('ucName').value.trim(),
                    ucNumber: document.getElementById('ucNumber').value.trim(),
                    lhwName: document.getElementById('lhwName').value.trim(),
                    householdName: document.getElementById('householdName').value.trim(),
                    location: this.locationData
                };
            }

            clearForm() {
                ['ucName', 'ucNumber', 'lhwName', 'householdName'].forEach(id => {
                    const input = document.getElementById(id);
                    input.value = '';
                    input.className = 'form-input flex w-full rounded-md border-gray-300 bg-gray-50 shadow-sm transition-all duration-200 h-11 px-4 placeholder:text-gray-400';
                    document.getElementById(`${id}-error`).classList.add('hidden');
                });
                
                this.locationData = null;
                this.validationErrors = {};
                this.clearDraft();
                setTimeout(() => this.startLocationDetection(), 1000);
            }

            // Draft Management
            scheduleDraftSave() {
                clearTimeout(this.draftTimer);
                this.draftTimer = setTimeout(() => this.saveDraft(), 2000);
            }

            saveDraft() {
                const data = this.getFormData();
                if (Object.values(data).some(v => typeof v === 'string' ? v.trim() : v)) {
                    localStorage.setItem('lhw_form_draft', JSON.stringify({ ...data, savedAt: new Date().toISOString() }));
                    this.showDraftIndicator();
                }
            }

            loadDraft() {
                const draft = localStorage.getItem('lhw_form_draft');
                if (draft) {
                    try {
                        const data = JSON.parse(draft);
                        if (new Date() - new Date(data.savedAt) < 24 * 60 * 60 * 1000) {
                            document.getElementById('ucName').value = data.ucName || '';
                            document.getElementById('ucNumber').value = data.ucNumber || '';
                            document.getElementById('lhwName').value = data.lhwName || '';
                            document.getElementById('householdName').value = data.householdName || '';
                            if (data.location) this.locationData = data.location;
                            this.showNotification('Draft restored', 'info');
                        }
                    } catch (e) { localStorage.removeItem('lhw_form_draft'); }
                }
            }

            clearDraft() {
                localStorage.removeItem('lhw_form_draft');
            }

            // Manual Location
            showManualModal() {
                document.getElementById('manual-location-modal').classList.replace('hidden', 'flex');
            }

            hideManualModal() {
                document.getElementById('manual-location-modal').classList.replace('flex', 'hidden');
                ['manual-address', 'manual-lat', 'manual-lon'].forEach(id => document.getElementById(id).value = '');
            }

            saveManualLocation() {
                const address = document.getElementById('manual-address').value.trim();
                const lat = parseFloat(document.getElementById('manual-lat').value);
                const lon = parseFloat(document.getElementById('manual-lon').value);
                
                if (!address && (isNaN(lat) || isNaN(lon))) {
                    this.showNotification('Enter address or coordinates', 'error');
                    return;
                }
                
                this.locationData = {
                    lat: lat || 0, lon: lon || 0,
                    address: address || `${lat}°, ${lon}°`,
                    method: 'Manual'
                };
                
                this.setLocationState('success');
                this.hideManualModal();
                this.showNotification('Manual location saved', 'success');
            }

            // Modal Management
            showLocationModal() {
                document.getElementById('location-modal').classList.replace('hidden', 'flex');
            }

            hideLocationModal() {
                document.getElementById('location-modal').classList.replace('flex', 'hidden');
            }

            // Notifications
            showNotification(message, type = 'info') {
                const container = document.getElementById('notification-container');
                const notification = document.createElement('div');
                const colors = { success: 'bg-green-500', error: 'bg-red-500', warning: 'bg-yellow-500', info: 'bg-blue-500' };
                
                notification.className = `notification ${colors[type]} text-white px-4 py-3 rounded-lg shadow-lg max-w-sm`;
                notification.innerHTML = `<span>${message}</span><button onclick="this.parentElement.remove()" class="ml-3 text-white">×</button>`;
                
                container.appendChild(notification);
                setTimeout(() => notification.classList.add('show'), 100);
                setTimeout(() => notification.remove(), 4000);
            }

            showDraftIndicator() {
                const indicator = document.getElementById('draft-indicator');
                indicator.classList.remove('opacity-0');
                setTimeout(() => indicator.classList.add('opacity-0'), 1500);
            }

            showWelcome() {
                setTimeout(() => this.showNotification('Welcome! Location detection started.', 'info'), 1000);
            }
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', () => new LHWApp());
    </script>